<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon"th:href="@{/images/01.jpg}" />
    <title>商品列表</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<style>
    /* 上传头像样式 */
    .imgtop {
        position: relative;
        top: 0px;
        left: 0px;
        width: 300px;
        height: auto;
        overflow: hidden;
        margin: 20px auto;
        color: #FFFFFF;

    }

    .in {
        position: absolute;
        /*top: 0;*/
        /*bottom: 0;*/
        /*left: 0;*/
        /*right: 0;*/
        opacity: 0;
    }
    .del{
        color: red;
        text-align: center;
        line-height: 20px;
        height: 20px;
        width: 20px;
        font-size: 18px;
        padding: 1px;
        top: -10px;
        right: -10px;
        position: relative;
    }

    .btnnn {
        width: 200px;
        height: 200px;

    }

    .spantext {
        font-size: 18px;
        color: #a09e9e;
        margin-top: 400px;
        margin-left: 20px;
    }

    .imgs {
        width: 150px;
        height: 150px;
        vertical-align: middle;
        border: 1px #eee;
        border-radius: 15px;
    }
</style>

<body>
<div id="app">
    <!-- <div id="loading"><div id="loading-center"></div></div> -->
    <div class="wrapper">
        <div class="iq-sidebar">
            <div class="iq-sidebar-logo d-flex justify-content-between">
                <a href="/Index">
                    <!-- <img src="images/01.jpg" class="img-fluid" alt=""> -->
                    <span>湛小鲜后台管理</span>
                </a>

            </div>
            <div id="sidebar-scrollbar">
                <nav class="iq-sidebar-menu">
                    <ul class="iq-menu">
                        <li class="active">
                            <a href="/Index" class="iq-waves-effect"><i
                                    class="ri-home-8-fill"></i><span>内部成员首页</span></a>
                        </li>

                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i
                                    class="ri-settings-5-fill"></i><span>营销情况</span><i
                                    class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/Index">营销情况</a></li>
                            </ul>
                        </li>

                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i
                                    class="ri-user-settings-fill"></i><span>商品管理 </span><i
                                    class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/CommodityList">商品列表</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-todo-fill"></i><span>订单管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/Orders">订单管理</a></li>
                            </ul>
                        </li>
                        <!--                    <li>-->
<!--                        <a href="javascript:void(0);" class="iq-waves-effect"><i-->
<!--                                class="ri-file-edit-fill"></i><span>快递管理</span><i-->
<!--                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>-->
<!--                        <ul class="iq-submenu">-->
<!--                            <li><a href="/Address">快递地址管理</a></li>-->
<!--                            <li><a href="/Delivery">配送管理</a></li>-->
<!--                        </ul>-->
<!--                    </li>-->

                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i
                                    class="ri-alarm-warning-fill"></i><span>优惠券 </span><i
                                    class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/Coupons">优惠券</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i
                                    class="ri-bar-chart-2-fill"></i><span>员工管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/HireUser_management">员工管理 </a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-barricade-fill"></i><span>内部成员管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/InternalUser_management">内部成员管理 </a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-battery-2-charge-line"></i><span>顾客管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/User_management">顾客管理 </a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="iq-waves-effect"><i
                                    class="ri-pie-chart-2-fill"></i><span>个人中心
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                            <ul class="iq-submenu">
                                <li><a href="/Mine">查看个人信息</a></li>
                                <!--<li><a href="/Member_info">查看成员信息</a></li>-->
<!--                                <li><a href="/Modify_Info">修改个人信息</a></li>-->
                                <li><a href="/Boss_management">注册账号</a></li>
                            </ul>
                        </li>

                    </ul>
                </nav>
                <div class="p-3"></div>
            </div>
        </div>

        <!-- Page Content  -->
        <div id="content-page" class="content-page">
            <!-- TOP Nav Bar -->
            <div class="iq-top-navbar">
                <div class="iq-navbar-custom">

                    <nav class="navbar navbar-expand-lg navbar-light p-0">
                        <div class="iq-search-bar">
                            <form action="#" class="searchbox">
                                <!-- 按照编号查找 -->
                                <span class="text search-input keyword">欢迎来到湛小鲜后台管理系统</span>
                            </form>
                        </div>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ml-auto navbar-list">
                                <!-- 全屏图标 -->
                                <li class="nav-item iq-full-screen">
                                    <a href="#" class="iq-waves-effect" id="btnFullscreen"><i
                                            class="ri-fullscreen-line"></i></a>
                                </li>
                            </ul>
                        </div>
                        <ul class="navbar-list">
                            <li>
                                <a href="#" class="search-toggle iq-waves-effect d-flex align-items-center">
                                   <img th:src="@{/images/01.jpg}" class="img-fluid rounded mr-3" alt="boss">
                                    <div class="caption">
                                        <h6 class="mb-0 line-height">湛小鲜</h6>
                                        <span class="font-size-12">管理员</span>
                                    </div>
                                </a>
                                <div class="iq-sub-dropdown iq-boss-dropdown">
                                    <div class="iq-card shadow-none m-0">
                                        <div class="iq-card-body p-0 ">
                                            <div class="bg-primary p-3">
                                                <h5 class="mb-0 text-white line-height">你好-湛小鲜</h5>
                                            </div>
                                            <a href="/Mine" class="iq-sub-card iq-bg-primary-hover">
                                                <div class="media align-items-center">
                                                    <div class="rounded iq-card-icon iq-bg-primary">
                                                        <i class="ri-file-boss-line"></i>
                                                    </div>
                                                    <div class="media-body ml-3">
                                                        <h6 class="mb-0 ">个人中心</h6>
                                                    </div>
                                                </div>
                                            </a>
<!--                                            <a href="/Modify_Info" class="iq-sub-card iq-bg-primary-hover">-->
<!--                                                <div class="media align-items-center">-->
<!--                                                    <div class="rounded iq-card-icon iq-bg-primary">-->
<!--                                                        <i class="ri-profile-line"></i>-->
<!--                                                    </div>-->
<!--&lt;!&ndash;                                                    <div class="media-body ml-3">&ndash;&gt;-->
<!--&lt;!&ndash;                                                        <h6 class="mb-0 ">修改个人信息</h6>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </div>&ndash;&gt;-->
<!--                                                </div>-->
<!--                                            </a>-->
                                            <div class="d-inline-block w-100 text-center p-3">
                                                <a class="bg-primary iq-sign-btn" href="/signIn" role="button">退出登录<i
                                                        class="ri-login-box-line ml-2"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="container-fluid">

                <div class="iq-card">
                    <div class="iq-card-header d-flex justify-content-between">
                        <div class="iq-header-title">
                            <h4 class="card-title">商品列表</h4>
                        </div>
                    </div>

                    <div class="iq-card-body">
                        <div class="topbtn">
                            <a href="#" class="btn btn-bg-gradient-x-purple-red" data-toggle="modal"
                               data-target="#myModal">添加商品</a>
                        </div>
                        <div class="selbox">
                            <div class="form1">
                                <ul class="row">
                                    <li class="col-xs-4">
                                        <span>状态：</span>
                                        <select class="form-control keyword1" v-model="keyword1" style="width: 320px;">
                                            <option value="0">下架</option>
                                            <option value="1">上架</option>
                                        </select>
                                    </li>

                                    <li class="col-xs-4">
                                        <span>商品名称：</span>
                                        <input type="text" v-model="keyword2" class="form-control keyword2">
                                    </li>
                                    <li class="col-xs-4" style="padding-left: 10px">
                                        <a href="javascript:;" class="btn btn-primary" @click="query()">查询</a>
                                    </li>
                                </ul>
                            </div>

                        </div>
                    </div>
                    <div class="tablebox">
                        <table class="table ">
                            <thead>
                            <tr>
<!--                                <th><input type="checkbox" class="allsel"></th>-->
                                <th>商品编号</th>
                                <th>商品名称</th>
                                <th>商品介绍</th>
                                <th>商品图片</th>
                                <th>商品销售量</th>
                                <th>商品类型</th>
                                <th>商品标签</th>
                                <th>商品状态</th>
                                <th>发货地址</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr v-for="commodity in commodityList">
<!--                                <td><input type="checkbox" class="seli"></td>-->
                                <td class="commodity_id">{{commodity.commodity_id}}</td>
                                <td>{{commodity.commodity_name}}</td>
                                <td>{{commodity.commodity_introduce}}</td>
                                <td><img :src="commodity.commodity_img" style="height: 100px; width:100px;"></td>
                                <td>{{commodity.commodity_sales}}</td>
                                <td><span class="badge badge-info">{{commodity.commodity_type}}</span></td>
                                <td><span class="badge badge-success">{{commodity.commodity_tag}}</span></td>
                                <td><span class="badge badge-warning" v-if="commodity.commodity_state==1">上架</span>
                                    <span class="badge badge-danger" v-else="commodity.commodity_state==0">下架</span>
                                </td>
                                <td>{{commodity.sendAddress}}</td>
                                <td>
                                    <a href="javaScript:;" @click="queryCommodity($event)">查看详情</a>
                                    <a href="javaScript:;" v-if="commodity.commodity_state==0"
                                       @click="returnDeleteCommodity($event)">上架</a>
                                    <a href="javaScript:;" v-else="commodity.commodity_state==1"
                                       @click="deleteCommodity($event)">下架</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
<!--                        <div class="">-->
<!--                            <a href="javaScript:;" class="btn btn-danger">下架</a>-->
<!--                        </div>-->
                    </div>
                    <nav aria-label="Page navigation" class="page">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" @click="prePageWay($event)" aria-label="Previous">
                                    <span aria-hidden="true">上一页</span>
                                </a>
                            </li>
                            <li :class="index==pageNum? 'page-item active':'page-item'"
                                v-for="index in navigatepageNums">
                                <a class="page-link" name="clickPage" @click="clickPageWay($event)" href="javascript:;">{{index}}</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" @click="nextPageWay($event)" aria-label="Next">
                                    <span aria-hidden="true">下一页</span>
                                </a>
                            </li>
                        </ul>
                    </nav>

                </div>

            </div>
        </div>
    </div>
    <!--添加商品-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">添加商品</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="form form-horizontal">
                        <div class="form-group row">
                            <label class="col-md-3 label-control">商品名称</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" v-model="newCommodity.commodity_name">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-3 label-control">商品介绍</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" v-model="newCommodity.commodity_introduce">
                            </div>
                        </div>

<!--                        <div class="form-group row">-->
<!--                            <label class="col-md-3 label-control" >销售量</label>-->
<!--                            <div class="col-md-9">-->
<!--                                <input type="text" class="form-control" v-model="newCommodity.commodity_sales">-->
<!--                            </div>-->
<!--                        </div>-->

                        <div class="form-group row">
                            <label class="col-md-3 label-control" >商品类型</label>
                            <div class="col-md-9">
                                <select class="form-control" style="width: 320px;"
                                               v-model="newCommodity.commodity_type">
                                <option value="水果">水果类</option>
                                <option value="蔬菜">蔬菜类</option>
                                <option value="肉">肉类</option>
                                <option value="海鲜">生鲜类</option>
                                <option value="研学活动">其它类</option>
                            </select>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-3 label-control" >商品标签</label>
                            <div class="col-md-9">
                                </span><select class="form-control" style="width: 320px;"
                                               v-model="newCommodity.commodity_tag">
                                <option>热销中</option>
                                <option>促销中</option>
                            </select>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-3 label-control">商品状态</label>
                            <div class="col-md-9">
                                </span><select class="form-control" style="width: 320px;"
                                               v-model="newCommodity.commodity_state">
                                <option value="1">上架</option>
                                <option value="0">下架</option>
                            </select>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-3 label-control">发货联系人</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" v-model="newCommodity.sendPeopleName">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-3 label-control">发货电话</label>
                            <div class="col-md-9">
                                <input  class="form-control"  type="tel" minlength="11" maxlength="11" placeholder="请输入11位数字"  onkeyup="value=value.replace(/[^\d]/g,'')"
                                       v-model="newCommodity.sendPhone">
                            </div>
                        </div>


                        <div class="form-group row">
                            <label class="col-md-3 label-control">发货地址</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" v-model="newCommodity.sendAddress">
                            </div>
                        </div>


<!--                        <div class="form-group row">-->
<!--                            <label class="col-md-3 label-control">备注</label>-->
<!--                            <div class="col-md-9">-->
<!--                                <input type="text" class="form-control" v-model="newCommodity.commodity_flag">-->
<!--                            </div>-->
<!--                        </div>-->

<!--                        &lt;!&ndash;添加商品主图片&ndash;&gt;-->
<!--                        <div class="imgtop">-->
<!--                            &lt;!&ndash; 只接受jpg，gif和png格式 &ndash;&gt;-->
<!--                            <input id="upload-input" class="in" type="file" accept="image/gif, image/jpg, image/png"-->
<!--                                    onchange="showImg(this)"/>-->
<!--                            &lt;!&ndash; 自定义按钮效果 &ndash;&gt;-->
<!--                            <div class="btnnn">-->
<!--                                <img id="upload" :src="newCommodity.commodity_img" class="imgs"/>-->
<!--                                <br>-->
<!--                                <span class="spantext">点击上传图片</span>-->
<!--                            </div>-->
<!--                        </div>-->

                        <!--添加商品轮播图-->
<!--                        <div class="imgtop">-->
<!--                            &lt;!&ndash; 只接受jpg，gif和png格式 &ndash;&gt;-->
<!--                            <input id="upload-input1" class="in" type="file" accept="image/gif, image/jpg, image/png"-->
<!--                                   ref="picx" onchange="showImg(this)" multiple/>-->
<!--                            &lt;!&ndash; 自定义按钮效果 &ndash;&gt;-->
<!--                            <div id="uploadBox">-->
<!--                            </div>-->
<!--                            <div class="btnnn">-->
<!--&lt;!&ndash;                                <img id="uploadBox" :src="" class="imgs"/>&ndash;&gt;-->
<!--                                <br>-->
<!--                                <span class="spantext">点击上传图片</span>-->
<!--                            </div>-->
<!--                        </div>-->

                        <div>
                            <section id="vue-imgUpload">
                                <div class="upload-pic">
                                    <input ref="picx1" type="file" accept="image/gif, image/jpg, image/png" multiple class="in" id="add-pic-btn" @change="addImg()">
                                    <span class="spantext">点击上传图片</span>
                                </div>
                                <div class="group-coms-pic" v-if="list.length>0" v-cloak>
                                    <div class="item" v-for="(v,i) in list" :key="i" >
                                        <div class="pic-box">
                                            <img style="width: 140px;height: 140px;" class="img" :src="v.src">
                                            <span class="del" @click="delImg(i)">x</span>
                                        </div>
                                        <div class="tk">{{v.name}}</div>
                                    </div>
                                </div>

                            </section>

                        </div>

                    </form>
                </div>

                <div class="modal-footer">
                    <span style="color: #ff0000">{{msg}}</span>
                    <button type="button" class="btn btn-def" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" @click="submit">执行操作</button>
                </div>
            </div>
        </div>
    </div>

</div>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/smooth-scrollbar.js}"></script>
<script th:src="@{/js/custom.js}"></script>
<script th:src="@{/js/echarts.min.js}"></script>
<script th:src="@{/js/axios-0.18.0.js}"></script>
<script th:src="@{/js/vue.js}"></script>
<script>
    // console.log("会还好")
    // function showImg(input) {
    //     var files = input.files;
    //     for(let i=0;i<files.length;i++){
    //         var temFile = files[i];
    //         var reader = new FileReader();
    //         reader.readAsDataURL(temFile);
    //         reader.onload=function (e){
    //             console.log(e.target.result);
    //             document.getElementById("uploadBox").innerHTML += "<img src='" + e.target.result + "'>";
    //         }
    //     }
    // }

    new Vue({
        el: '#app',
        data: {
            commodityList: [],
            // 新商品
            newCommodity: {
                    commodity_id: "",
                    commodity_name: "",
                    commodity_introduce:"",
                    commodity_img: "",
                    commodity_carousel_Img:"",
                    commodity_sales: 0,
                    commodity_type: "",
                    commodity_tag: "",
                    commodity_state: 1,
                    address_id:"",
                    commodity_flag:""
                },

            // 复选框选中数据集合，点击复选框后一行数据以对象为单位全部保存进该数组
            multipleSelection: [],
            //所有导航页号
            navigatepageNums: [],
            //总页数
            pages: 0,
            //每页显示数
            pageSize: 0,
            //总条目数
            totalCount: 0,
            // 当前页码
            pageNum: 1,
            //是否有上一页
            hasPreviousPage: false,
            //是否有下一页
            hasNextPage: false,
            // 是否为第一页
            isFirstPage: false,
            //	是否为最后一页
            isLastPage: false,
            //上一页
            prePage: 0,
            // 下一页
            nextPage: 0,
            if_Search: 0,//判断该页面的数据是否是查询后的数据
            keyword1:'',//第一个输入框的值
            keyword2:'',//第二个输入框的值
            commodityPhoto:"commodityPhoto",//员工图片文件夹的名字
            msg:"",//添加成功的提示

            //上传照片
            list:[], //用于结构渲染
            allArr:[],  //存储每次上传的所有flie，
            limitNum:6, //限制数量
            Filesz:[]

        },
        mounted() {
            console.log("商品列表是:",this.commodityList);
            // 请求后端数据
            axios
                .get('/managerCommodityController/findAllCommodityByPage')
                .then(response =>(//请求成功
                    this.updateData(response)
                    )
                )
                .catch(function (error) {
                    // console.log(error);//请求失败
                })
        },
        methods: {

            //更新页面数据的方法封装
            updateData(response) {
                console.log(response.data)//返回的数据
                console.log("数组数据："+response.data.list)
                this.commodityList = response.data.list,
                    this.totalCount = response.data.total,//设置总条数
                    this.pageSize = response.data.pageSize,//设置当前页面显示的数据条目
                    this.pageNum = response.data.pageNum,//设置当前页码
                    this.pages = response.data.pages,//设置总页数
                    this.hasPreviousPage = response.data.hasPreviousPage,//是否有上一页
                    this.hasNextPage = response.data.hasNextPage,//是否有下一页
                    this.isFirstPage = response.data.isFirstPage,//是否为第一页
                    this.isLastPage = response.data.isLastPage,//是否为最后一页
                    this.prePage = response.data.prePage,//上一页
                    this.nextPage = response.data.nextPage//下一页
                this.navigatepageNums = response.data.navigatepageNums//设置所有导航页号
            },
            //上一页
            prePageWay(e) {
                if (this.if_Search == 1) {//判断是否为查询过的页面
                    if (this.hasPreviousPage == true) {
                        axios.get('/managerCommodityController/conditionalQueriesCommodity?pageNum='+ this.prePage + '&keyword1=' + this.keyword1 + '&keyword2=' + this.keyword2)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    } else {
                        axios.get('/managerCommodityController/conditionalQueriesCommodity?pageNum=' + 1 + '&keyword1=' + this.keyword1 + '&keyword2=' + this.keyword2)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    }
                } else{//判断是否为查询过的页面
                    if (this.hasPreviousPage == true) {
                        axios.get('/managerCommodityController/findAllCommodityByPage?pageNum=' + this.prePage)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    } else {
                        axios.get('/managerCommodityController/findAllCommodityByPage?pageNum=' + 1)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    }
                }
            },

            //下一页
            nextPageWay(e) {
                if (this.if_Search == 1) {//判断是否为查询过的页面
                    if (this.hasNextPage == true) {
                        axios.get('/managerCommodityController/conditionalQueriesCommodity?pageNum=' + this.nextPage  + '&keyword1=' + this.keyword1 + '&keyword2=' + this.keyword2)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    } else {
                        axios.get('/managerCommodityController/conditionalQueriesCommodity?pageNum=' + this.pages  + '&keyword1=' + this.keyword1 + '&keyword2=' + this.keyword2)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    }
                }else {
                    if (this.hasNextPage == true) {
                        axios.get('/managerCommodityController/findAllCommodityByPage?pageNum=' + this.nextPage)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    } else {
                        axios.get('/managerCommodityController/findAllCommodityByPage?pageNum=' + this.pages)
                            .then(response => {
                                this.updateData(response);
                            })
                            .catch(function (error) {
                                console.log(error);
                            })
                    }
                }
            },

            //点击页数
            clickPageWay(e) {
                if(this.if_Search == 1){//判断是否为查询过的页面
                var id = event.currentTarget.innerHTML;
                console.log("id" + id)
                axios.get('/managerCommodityController/conditionalQueriesCommodity?pageNum=' + id  + '&keyword1=' + this.keyword1 + '&keyword2=' + this.keyword2)
                    .then(response => {
                        this.updateData(response);
                    })
                    .catch(function (error) {
                        console.log(error);
                    })
            }else{
                    var id = event.currentTarget.innerHTML;
                    console.log("id" + id)
                    axios.get('/managerCommodityController/findAllCommodityByPage?pageNum=' + id)
                        .then(response => {
                            this.updateData(response);
                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                }
            },
            //删除商品
            deleteCommodity(e) {
                if (confirm("若没有被顾客下单的商品，会直接删除该商品的所有信息，会有信息丢失的风险，您是否确定删除？")) {
                    var id = e.currentTarget.parentElement.parentElement.getElementsByClassName("commodity_id")[0].innerText;
                    axios.get('/managerCommodityController/deleteByCommodityForever?commodity_id=' + id)
                        .then(response => {
                            // console.log(this.state);
                            console.log(response.data)//返回的数据
                            alert(response.data.message)
                            window.location.href = 'CommodityList'
                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                }
            },

            //回归被删除的商品
            returnDeleteCommodity(e) {
                if (confirm("您是否确定上架被删除的商品？")) {
                    var id = e.currentTarget.parentElement.parentElement.getElementsByClassName("commodity_id")[0].innerText;
                    axios.get('/managerCommodityController/returnDeleteByCommodityForever?commodity_id=' + id)
                        .then(response => {
                            // console.log(this.state);
                            console.log(response.data)//返回的数据
                            alert(response.data.message)
                            window.location.href = 'CommodityList'
                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                }
            },
            // 查看详情商品
            queryCommodity(e) {
                var id = e.currentTarget.parentElement.parentElement.getElementsByClassName("commodity_id")[0].innerText;
                e.currentTarget.href = '/managerCommodityController/Commodity_details?commodity_id=' + id;
                console.log(e.currentTarget.href);
            },
            // 复选框选中后执行的方法
            handleSelectionChange(val) {
                this.multipleSelection = val;
            },
            // 批量删除商品
            deleteByids() {
                this.multipleSelection.forEach((item) => {
                    this.ids.push(item.id)
                })
                console.log(this.ids)
                if (this.ids.length == 0) {
                    this.$message({
                        type: 'success',
                        message: '请先选择需要删除的信息'
                    })
                } else {
                    this.$confirm('你确定吗？', '提示', {
                        confirmButtonText: "确认删除？",
                        concelButtonText: "取消",
                        type: 'warning'
                    }).then(function (resp) {
                        axios({
                            method: "get",
                            url: "/接口",
                            data: ids
                        }).then(function (resp) {
                            if (resp.data > 0) {
                                mounted();
                            }
                        })
                    })
                }
            },



            // // 添加新商品
            // addNewCommodity() {
            //     axios
            //         .post('/managerCommodityController/addCommodity', this.newCommodity).then(response => (
            //             console.log(response.data),
            //                 window.location.href = 'CommodityList'
            //         )
            //     )
            //         .catch(function (error) { // 请求失败处理
            //             console.log(error);
            //         });
            // },



            // 按字段查询
            query() {
                axios({
                    method: 'get',
                    url: '/managerCommodityController/conditionalQueriesCommodity?keyword1=' + this.keyword1 + '&keyword2=' + this.keyword2,
                }).then(res => {
                        console.log("查询成功");
                        console.log(res);
                        if (res.data.size != 0) {
                            this.updateData(res);
                            this.if_Search = 1;//标记该页面是已经搜索过的页面
                        }else {
                            alert("暂无该搜索数据，可换个词语重新搜索噢~~")
                        }
                    },
                    err => {
                        console.log(err);
                    }
                )
            },

            //分页
            handleSizeChange(val) {
                // console.log(`每页 ${val} 条`);
                //设置每一页的分页查询
                this.pageSize = val
                mounted();
            },
            handleCurrentChange(val) {
                //console.log(`当前页: ${val}`);
                //重新设置当前页码
                this.currentPage = val
                mounted();
            },



            //上传照片部分
            //添加图片
            addImg(){
                let that = this;
                var obj = that.getId('add-pic-btn'),
                    obArr =  obj.files,
                    length = obArr.length,
                    arr = [],
                    limitNum = that.limitNum;
                console.log(obj.files);
                console.log(length);
                for(let x of obArr){
                    var params = {name: x.name, src:'',file: x};
                    arr.push(params);
                }
                that.allArr = [...that.allArr,...arr];
                //定义一个函数作回调
                const Pro = function () {
                    return new Promise(function (resolve, reject) {
                        arr.forEach((v,i,array)=>{
                            resolve(array)
                        });
                    })
                };
                Pro().then((newArr)=>{
                    // console.log(newArr);
                    for(let i=0; i<newArr.length; i++) {
                        var reader = new FileReader();
                        if (!reader) {
                            console.log('对不起，您的浏览器不支持！请更换浏览器试一下');
                            return
                        }
                        //读取成功
                        reader.onload = function(e) {
                            // console.log(e)
                            var _src = e.target.result;
                            newArr[i].src = _src;
                            that.clearVal();
                        };
                        reader.onloadstart=function(){
                            console.log('开始')
                        };
                        reader.onprogress=function(e){
                            if(e.lengthComputable){
                                console.log("正在读取文件")
                            }
                        };
                        reader.error = function(){
                            console.log("读取异常")
                        };
                        reader.readAsDataURL(obj.files[i]);
                    }
                    //合并数组,先合并在删除多余；
                    var len1 = that.list.length,
                        len2 = newArr.length;
                    var d = [...that.list,...newArr];
                    that.list = d;
                    // console.log(len1,len2,d)
                    if(d.length > limitNum){
                        alert(`最多只能上传${limitNum}张图片`);
                        that.list.splice(limitNum,d.length-limitNum);
                        // console.log(that.list)
                    }
                });
            },
            //删除图片
            delImg(i){
                var flag = confirm(`确认要删除名为：${this.list[i].name}的图片？`);
                if(flag) {
                    this.list.splice(i,1);
                    this.allArr.splice(i,1);
                }
                //这个得清空，不然全部被删除后，无法再次上传同一图片
                if(this.list.length<=0){
                    this.clearVal();
                }
            },
            //每次上传完清除一下value
            clearVal(){
                this.getId('add-pic-btn').value = null;
            },
            //dom
            getId(id){
                return document.getElementById(id);
            },

            // submit1() {
            //     var that = this;
            //     console.log(that.allArr);
            //     let fd = new FormData();
            //     for (let i = 0; i < that.allArr.length; i++) {
            //         fd.append('files', that.allArr[i].file);
            //         console.log(that.allArr[i].file);
            //     }
            //     fd.append("userid", that.userid);
            //     axios({
            //         url: "/PhotoUploadMore",
            //         method: "post",
            //         headers: {'Content-Type': 'multipart/form-data'},
            //         data: fd
            //     }).then(function (reponse) {
            //         console.log(reponse);
            //         var data = reponse.data;
            //         if (data.code == 200) {
            //             // that.msg1=data.message;
            //             // that.list = data.data;
            //         } else {
            //             // that.msg1=data.message;
            //         }
            //     })
            // },
            submit(){
                var that =this;
                console.log(that.allArr);
                if(that.allArr.length==0){
                    alert("请上传头像");
                }else{
                let fd = new FormData();
                for (let i = 0; i < that.allArr.length; i++) {
                    fd.append('files', that.allArr[i].file);
                    console.log(that.allArr[i].file);
                }
                fd.append("commodityPhoto",this.commodityPhoto);
                let descJson = JSON.stringify(this.newCommodity);                           //对象数组转换为JSON
                let descBob  = new Blob([descJson], {                               //对象数组转换为Blob
                    type: 'application/json',
                });
                // console.log(this.newHireUser)
                fd.append("commodity",descBob);
                axios({
                    url: "/managerCommodityController/addCommodity",
                    method: "post",
                    headers: {'Content-Type': 'multipart/form-data'},
                    data: fd
                }).then(function (reponse) {
                    console.log(reponse);
                    var data = reponse.data;
                    window.location.href = 'CommodityList'
                    if (data.code == 200) {
                        // that.msg1=data.message;
                        that.list = data.data;
                    } else {
                        that.msg=data.message;
                    }
                })
                }
            },
        }
    })

</script>
</body>

</html>