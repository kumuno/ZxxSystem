<!--修改订单-->
<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon"th:href="@{/images/01.jpg}" />
    <title>修改订单</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/address-picker.css}">
</head>
<style>
    .spantext {
        font-size: 18px;
        color: #a09e9e;
        margin-top: 400px;
        margin-left: 20px;
    }

    .imgs {
        width: 150px;
        height: 150px;
        vertical-align: middle;
        border: 1px #eee;
        border-radius: 15px;
    }


</style>
<body>
<!-- <div id="loading"><div id="loading-center"></div></div> -->
<div class="wrapper" id="app">
    <div class="iq-sidebar">
        <div class="iq-sidebar-logo d-flex justify-content-between">
            <a href="Index.html">
                <!-- <img src="images/01.jpg" class="img-fluid" alt=""> -->
                <span>湛小鲜后台管理</span>
            </a>

        </div>
        <div id="sidebar-scrollbar">
            <nav class="iq-sidebar-menu">
                <ul class="iq-menu">

                    <li class="active">
                        <a href="/Index" class="iq-waves-effect"><i
                                class="ri-home-8-fill"></i><span>内部成员首页</span></a>
                    </li>

                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i
                                class="ri-settings-5-fill"></i><span>营销情况</span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/Index">营销情况</a></li>
                        </ul>
                    </li>

                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i
                                class="ri-user-settings-fill"></i><span>商品管理 </span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/CommodityList">商品列表</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-todo-fill"></i><span>订单管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/Orders">订单管理</a></li>
                        </ul>
                    </li>
                    <!--                    <li>-->
<!--                        <a href="javascript:void(0);" class="iq-waves-effect"><i-->
<!--                                class="ri-file-edit-fill"></i><span>快递管理</span><i-->
<!--                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>-->
<!--                        <ul class="iq-submenu">-->
<!--                            <li><a href="/Address">快递地址管理</a></li>-->
<!--                            <li><a href="/Delivery">配送管理</a></li>-->
<!--                        </ul>-->
<!--                    </li>-->

                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i
                                class="ri-alarm-warning-fill"></i><span>优惠券 </span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/Coupons">优惠券</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i
                                class="ri-bar-chart-2-fill"></i><span>员工管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/HireUser_management">员工管理 </a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-barricade-fill"></i><span>内部成员管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/InternalUser_management">内部成员管理 </a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-battery-2-charge-line"></i><span>顾客管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/User_management">顾客管理 </a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="iq-waves-effect"><i
                                class="ri-pie-chart-2-fill"></i><span>个人中心
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul class="iq-submenu">
                            <li><a href="/Mine">查看个人信息</a></li>
                            <!--<li><a href="/Member_info">查看成员信息</a></li>-->
                            <!--                                <li><a href="/Modify_Info">修改个人信息</a></li>-->
                            <li><a href="/Boss_management">注册账号</a></li>
                        </ul>
                    </li>

                </ul>
            </nav>
            <div class="p-3"></div>
        </div>
    </div>

    <!-- Page Content  -->
    <div id="content-page" class="content-page">
        <!-- TOP Nav Bar -->
        <div class="iq-top-navbar">
            <div class="iq-navbar-custom">

                <nav class="navbar navbar-expand-lg navbar-light p-0">
                    <div class="iq-search-bar">
                        <form action="#" class="searchbox">
                            <span class="text search-input keyword">欢迎来到湛小鲜后台管理系统</span>
                        </form>
                    </div>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav ml-auto navbar-list">
                            <!-- 全屏图标 -->
                            <li class="nav-item iq-full-screen">
                                <a href="#" class="iq-waves-effect" id="btnFullscreen"><i
                                        class="ri-fullscreen-line"></i></a>
                            </li>
                        </ul>
                    </div>
                    <ul class="navbar-list">
                        <li>
                            <a href="#" class="search-toggle iq-waves-effect d-flex align-items-center">
                               <img th:src="@{/images/01.jpg}" class="img-fluid rounded mr-3" alt="boss">
                                <div class="caption">
                                    <h6 class="mb-0 line-height">湛小鲜</h6>
                                    <span class="font-size-12">管理员</span>
                                </div>
                            </a>
                            <div class="iq-sub-dropdown iq-boss-dropdown">
                                <div class="iq-card shadow-none m-0">
                                    <div class="iq-card-body p-0 ">
                                        <div class="bg-primary p-3">
                                            <h5 class="mb-0 text-white line-height">你好-湛小鲜</h5>
                                        </div>
                                        <a href="/Mine" class="iq-sub-card iq-bg-primary-hover">
                                            <div class="media align-items-center">
                                                <div class="rounded iq-card-icon iq-bg-primary">
                                                    <i class="ri-file-boss-line"></i>
                                                </div>
                                                <div class="media-body ml-3">
                                                    <h6 class="mb-0 ">个人中心</h6>
                                                </div>
                                            </div>
                                        </a>
                                        <!--                                 <a href="/Modify_Info" class="iq-sub-card iq-bg-primary-hover">-->
<!--                                    <div class="media align-items-center">-->
<!--                                       <div class="rounded iq-card-icon iq-bg-primary">-->
<!--                                          <i class="ri-profile-line"></i>-->
<!--                                       </div>-->
<!--                                       <div class="media-body ml-3">-->
<!--                                          <h6 class="mb-0 ">修改个人信息</h6>-->
<!--                                       </div>-->
<!--                                    </div>-->
<!--                                 </a>-->
                                        <div class="d-inline-block w-100 text-center p-3">
                                            <a class="bg-primary iq-sign-btn" href="/Login" role="button">退出登录<i
                                                    class="ri-login-box-line ml-2"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </nav>

            </div>
        </div>
        <!-- TOP Nav Bar END -->
        <div class="content-wrapper">
            <div class="content-header ">
                <div class="content-header-left mb-2 clearfix">
                    <h3 class="content-header-title mb-0 pull-left">修改订单</h3>
                    <ol class="breadcrumb pull-right">
                        <!--需修改地址-->
                        <li><a href="/Orders">订单详情</a></li>
                        <li class="active">修改订单</li>
                    </ol>
                </div>
            </div>
            <div class="card">
                <div class="card-content">
                    <div class="card-body">
                        <div class="funcbtn clearfix">
                            <!--需修改地址-->
                            <div class="pull-left"><a class="btn btn-default" href="/Orders"> 返回</a></div>
                        </div>
                        <div class="form1 form3">
                            <ul class="row">
                                <li class="col-sm-10 col-xs-12"><span>订单编号：</span><input disabled type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_id">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>用户编号：</span><input disabled type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.user_id">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>是否删除：</span><input disabled
                                                                                         v-if="newOrderInformation.order_user_delete == 1"
                                                                                         type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         value="是">
                                    <input disabled v-else
                                           type="text"
                                           class="form-control"
                                           style="width: 600px;"
                                           value="否">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span style="width: auto;">商品总数量：</span><input disabled
                                                                                                               type="text"
                                                                                                               class="form-control"
                                                                                                               style="width: 585px;margin-left: 15px"
                                                                                                               v-model="newOrderInformation.order_account">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>商品总价：</span><input disabled type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.good_sumprice">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>订单总价：</span><input disabled type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_sumPrice">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>订单状态：</span><select class="form-control"
                                                                                          style="width: 600px;"
                                                                                          v-model="newOrderInformation.order_status">
                                    <option>待付款</option>
                                    <option>待发货</option>
                                    <option>待收货</option>
                                    <option>已收货</option>
                                    <option>待退款</option>
                                    <option>已退款</option>
                                </select></li>
                                <li class="col-sm-10 col-xs-12"><span>支付方式：</span><select class="form-control"
                                                                                          style="width: 600px;"
                                                                                          v-model="newOrderInformation.order_way">
                                    <option value="待支付">待支付</option>
                                    <option value="微信支付">微信支付</option>
                                    <option value="支付宝支付">支付宝支付</option>
                                </select></li>
                                <li class="col-sm-10 col-xs-12"><span>订单备注：</span><input type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_remark">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>联系人员：</span><input type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newShipAddress.address_contact">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>联系电话：</span><input type="tel" minlength="11" maxlength="11" placeholder="请输入11位数字"  onkeyup="value=value.replace(/[^\d]/g,'')"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newShipAddress.address_phone">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>收货地区：</span><input id="test" type="text" placeholder="请选择地区信息"
                                                                                         class="form-control"
                                                                                         style="width: 600px;cursor:pointer;"
                                                                                         v-model="newShipAddress.regionAddress">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>详细地址：</span><input type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newShipAddress.detailAddress">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>退款原因：</span><input type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_refund_reason">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>退款说明：</span><input type="text"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_refund_instructions">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>支付时间：</span><input type="datetime-local"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_paymentTime">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>创建时间：</span><input type="datetime-local"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_createTime">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>修改时间：</span><input type="datetime-local"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_newCreateTime">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>发货时间：</span><input type="datetime-local"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_shipping_time">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>收货时间：</span><input type="datetime-local"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_confirm_time">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span style="width: auto">申请退款时间：</span><input
                                        type="datetime-local"
                                        class="form-control"
                                        style="width: 575px;margin-left: 25px"
                                        v-model="newOrderInformation.order_apply_refundTime">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span>退款时间：</span><input type="datetime-local"
                                                                                         class="form-control"
                                                                                         style="width: 600px;"
                                                                                         v-model="newOrderInformation.order_refund_time">
                                </li>
                                <li class="col-sm-10 col-xs-12"><span style="width: auto">预计到货时间：</span><input
                                        type="datetime-local"
                                        class="form-control"
                                        style="width: 575px;margin-left: 25px;"
                                        v-model="newOrderInformation.order_predict_predictTime">
                                </li>

                                <li class="col-sm-10 col-xs-12"><input type="submit" class="btn btn-primary"
                                                                       value="确认修改"  @click="updateNewOrder($event)">
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js}" type="text/javascript"></script>
<script th:src="@{/js/address-picker.js}"></script>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/smooth-scrollbar.js}"></script>
<script th:src="@{/js/custom.js}"></script>
<script th:src="@{/js/echarts.min.js}"></script>
<script th:src="@{/js/axios-0.18.0.js}"></script>
<script th:src="@{/js/vue.js}"></script>
</body>
<script>

    // 获取对应id
    function getQueryString(order_id) {
        var reg = new RegExp('(^|&)' + order_id + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(r[2]);
        }
    }

    var order_id = getQueryString("order_id");
    console.log(order_id);


    new Vue({
        el: '#app',
        data: {
            orderInformationList: [],
            newOrderInformation: {
                order_id: "",
                order_account: 0,
                user_id: "",
                good_sumprice: 0.00,
                order_sumPrice: 0.00,
                order_paymentTime: "YYYY-MM-DD HH：MM：SS",
                order_status: "",
                order_way: "",
                order_remark: "",
                address_id: "",
                order_user_delete: 0,
                order_refund_reason: "",
                order_refund_instructions: "",
                order_refund_image: "",
                order_createTime: "yyyy/MM/dd hh:mm",
                order_newCreateTime: "YYYY-MM-DD HH：MM：SS",
                order_shipping_time: "YYYY-MM-DD HH：MM：SS",
                order_confirm_time: "YYYY-MM-DD HH：MM：SS",
                order_apply_refundTime: "YYYY-MM-DD HH：MM：SS",
                order_refund_time: "YYYY-MM-DD HH：MM：SS",
                order_predict_predictTime: "YYYY-MM-DD HH：MM：SS"
            },
            shipAddress: {},
            newShipAddress: {
                regionAddress:""
            },
        },

        mounted() {//查找对应的订单
            axios
                .get('/getOrderInformation?order_id=' + order_id)
                .then(response => (
                        console.log(response.data),
                            this.orderInformationList = response.data.data,
                            this.shipAddress = response.data.data.shipAddress,
                            console.log(this.orderInformationList),
                            this.newOrderInformation = this.orderInformationList,
                            this.newShipAddress = this.shipAddress
                    )
                )
                .catch(function (error) { // 请求失败处理
                    // console.log(error);
                });

        },
        methods: {
            updateNewOrder(e) {//修改订单
                let event = e;
                var inputDom = document.getElementById("test").value;
                this.newShipAddress.regionAddress = inputDom;
                console.log(JSON.stringify(this.newShipAddress))
                console.log("inputDon:"+inputDom)
                if (confirm("您是否确认修改")) {
                    if (this.checkOrderStateAndTime() == true){
                        axios.get('/updateOrderInformation', {
                            params: {
                                orderInformation: encodeURIComponent(JSON.stringify(this.newOrderInformation)),
                                shipAddress: JSON.stringify(this.newShipAddress)
                            }
                        }).then(response => (
                            console.log(response),
                                window.location.href = 'Order_details?order_id=' + order_id
                        )).catch(function (error) { // 请求失败处理
                            console.log(error);
                        });
                    }
                }
            },
            checkOrderStateAndTime(){
                if(this.newOrderInformation.order_status =="待发货"){
                    if (this.newOrderInformation.order_way =="待支付"){
                        alert("订单状态为待发货，请输入支付方式!");
                        return false;
                    }
                    alert("2222"+this.newOrderInformation.order_paymentTime)
                    if (this.newOrderInformation.order_paymentTime == null){
                        alert("订单状态为待发货，请输入支付时间!");
                        return false;
                    }
                    return true;
                }

                if(this.newOrderInformation.order_status =="待收货"){
                    if (this.newOrderInformation.order_shipping_time ==null){
                        alert("订单状态为待收货，请输入发货时间!");
                        return false;
                    }
                    if (this.newOrderInformation.order_predict_predictTime ==null){
                        alert("订单状态为待收货，请输入预计到货时间!");
                        return false;
                    }
                    var date1 = new Date(this.newOrderInformation.order_shipping_time);
                    var date2 = new Date(this.newOrderInformation.order_predict_predictTime);
                    if (date1>=date2){
                        alert("订单状态为待收货，请输入预计到货时间不能小于或等于发货时间!");
                        return false;
                    }else {
                        console.log("时间：",date2-date1)
                    }
                    return true;
                }

                if(this.newOrderInformation.order_status =="已收货"){
                    if (this.newOrderInformation.order_confirm_time == null){
                        alert("订单状态为已收货，请输入收货时间!");
                        return false;
                    }
                    return true;
                }

                if(this.newOrderInformation.order_status =="待退款"){
                    if (this.newOrderInformation.order_apply_refundTime == null){
                        alert("订单状态为待退款，请输入申请退款时间!");
                        return false;
                    }
                    return true;
                }

                if(this.newOrderInformation.order_status =="已退款"){
                    if (this.newOrderInformation.order_refund_time == null){
                        alert("订单状态为已退款，请输入退款时间!");
                        return false;
                    }
                    return true;
                }

                return true;

            }

        },


    })

    var addressData;//存储中国的省市区的数据

    $.ajax({
        type: "get", //使用get方式
        url: "/data/pcas-code.json", //json文件相对于这个HTML的路径
        dataType: "json",
        async: false,
        success: function (data) {
            //这个data就是json数据
            // console.log(data);
            addressData = data;
        },
        error: function () {
            alert("请求失败");
        }
    });
    console.log(addressData);

    // var data = getData();
    var address_picker;
    $(document).ready(function () {
        address_picker = new addressPicker({
            id: "test",
            level: 5,
            data: addressData,
            btnConfig: [{
                text: '重新选择',
                click: function () {
                    address_picker.clearSelectedData();
                    $("#test").val("");
                }
            }]
        });
        address_picker.on("click", function () {
            $("#test").val(address_picker.getTotalValueAsText());
        });
    });

</script>

</html>