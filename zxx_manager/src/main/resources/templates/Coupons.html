<!--优惠券-->
<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon"th:href="@{/images/01.jpg}" />
   <title>优惠券</title>
   <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
   <!-- <div id="loading"><div id="loading-center"></div></div> -->
   <div class="wrapper" id="app">
      <div class="iq-sidebar">
         <div class="iq-sidebar-logo d-flex justify-content-between">
            <a href="/Index">
               <!-- <img src="images/01.jpg" class="img-fluid" alt=""> -->
               <span>湛小鲜后台管理</span>
            </a>

         </div>
         <div id="sidebar-scrollbar">
            <nav class="iq-sidebar-menu">
               <ul class="iq-menu">

                  <li class="active">
                     <a href="/Index" class="iq-waves-effect"><i class="ri-home-8-fill"></i><span>内部成员首页</span></a>
                  </li>

                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i
                             class="ri-settings-5-fill"></i><span>营销情况</span><i
                             class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/Index">营销情况</a></li>
                     </ul>
                  </li>

                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i
                             class="ri-user-settings-fill"></i><span>商品管理 </span><i
                             class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/CommodityList">商品列表</a></li>
                     </ul>
                  </li>
                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-todo-fill"></i><span>订单管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/Orders">订单管理</a></li>
                     </ul>
                  </li>
                  <!--                    <li>-->
<!--                        <a href="javascript:void(0);" class="iq-waves-effect"><i-->
<!--                                class="ri-file-edit-fill"></i><span>快递管理</span><i-->
<!--                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>-->
<!--                        <ul class="iq-submenu">-->
<!--                            <li><a href="/Address">快递地址管理</a></li>-->
<!--                            <li><a href="/Delivery">配送管理</a></li>-->
<!--                        </ul>-->
<!--                    </li>-->

                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i
                             class="ri-alarm-warning-fill"></i><span>优惠券 </span><i
                             class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/Coupons">优惠券</a></li>
                     </ul>
                  </li>
                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-bar-chart-2-fill"></i><span>员工管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/HireUser_management">员工管理 </a></li>
                     </ul>
                  </li>
                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-barricade-fill"></i><span>内部成员管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/InternalUser_management">内部成员管理 </a></li>
                     </ul>
                  </li>
                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-battery-2-charge-line"></i><span>顾客管理
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/User_management">顾客管理 </a></li>
                     </ul>
                  </li>
                  <li>
                     <a href="javascript:void(0);" class="iq-waves-effect"><i class="ri-pie-chart-2-fill"></i><span>个人中心
                        </span><i class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                     <ul class="iq-submenu">
                        <li><a href="/Mine">查看个人信息</a></li>
                        <!--<li><a href="/Member_info">查看成员信息</a></li>-->
<!--                        <li><a href="/Modify_Info">修改个人信息</a></li>-->
                        <li><a href="/Boss_management">注册账号</a></li>
                     </ul>
                  </li>

               </ul>
            </nav>
            <div class="p-3"></div>
         </div>
      </div>

      <!-- Page Content  -->
      <div id="content-page" class="content-page">
         <!-- TOP Nav Bar -->
         <div class="iq-top-navbar">
            <div class="iq-navbar-custom">

               <nav class="navbar navbar-expand-lg navbar-light p-0">
                  <div class="iq-search-bar">
                     <form action="#" class="searchbox">
                        <!-- 按照编号查找 -->
                        <span class="text search-input keyword">欢迎来到湛小鲜后台管理系统</span>
                     </form>
                  </div>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                     <ul class="navbar-nav ml-auto navbar-list">
                        <!-- 全屏图标 -->
                        <li class="nav-item iq-full-screen">
                           <a href="#" class="iq-waves-effect" id="btnFullscreen"><i class="ri-fullscreen-line"></i></a>
                        </li>
                     </ul>
                  </div>
                  <ul class="navbar-list">
                     <li>
                        <a href="#" class="search-toggle iq-waves-effect d-flex align-items-center">
                          <img th:src="@{/images/01.jpg}" class="img-fluid rounded mr-3" alt="boss">
                           <div class="caption">
                              <h6 class="mb-0 line-height">湛小鲜</h6>
                              <span class="font-size-12">管理员</span>
                           </div>
                        </a>
                        <div class="iq-sub-dropdown iq-boss-dropdown">
                           <div class="iq-card shadow-none m-0">
                              <div class="iq-card-body p-0 ">
                                 <div class="bg-primary p-3">
                                    <h5 class="mb-0 text-white line-height">你好-湛小鲜</h5>
                                 </div>
                                 <a href="/Mine" class="iq-sub-card iq-bg-primary-hover">
                                    <div class="media align-items-center">
                                       <div class="rounded iq-card-icon iq-bg-primary">
                                          <i class="ri-file-boss-line"></i>
                                       </div>
                                       <div class="media-body ml-3">
                                          <h6 class="mb-0 ">个人中心</h6>
                                       </div>
                                    </div>
                                 </a>
<!--                                 <a href="/Modify_Info" class="iq-sub-card iq-bg-primary-hover">-->
<!--                                    <div class="media align-items-center">-->
<!--                                       <div class="rounded iq-card-icon iq-bg-primary">-->
<!--                                          <i class="ri-profile-line"></i>-->
<!--                                       </div>-->
<!--&lt;!&ndash;                                       <div class="media-body ml-3">&ndash;&gt;-->
<!--&lt;!&ndash;                                          <h6 class="mb-0 ">修改个人信息</h6>&ndash;&gt;-->
<!--&lt;!&ndash;                                       </div>&ndash;&gt;-->
<!--                                    </div>-->
<!--                                 </a>-->
                                 <div class="d-inline-block w-100 text-center p-3">
                                    <a class="bg-primary iq-sign-btn" href="/signIn" role="button">退出登录<i
                                            class="ri-login-box-line ml-2"></i></a>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </li>
                  </ul>
               </nav>

            </div>
         </div>
         <!-- TOP Nav Bar END -->
         <div class="container-fluid">
            <div class="iq-card">
               <div class="iq-card-header d-flex justify-content-between">
                  <div class="iq-header-title">
                     <h4 class="card-title">优惠券</h4>
                  </div>
               </div>
               <div class="iq-card-body">
                  <div class="topbtn">
                     <a href="#" class="btn btn-bg-gradient-x-purple-red" data-toggle="modal"
                        data-target="#myModal">添加优惠券</a>

                  </div>
                  <div class="selbox">
                     <div class="form1">
                        <ul class="row">
                           <li class="col-xs-4">
                              <span>券编号：</span>
                              <input type="text" class="form-control keyword1">
                           </li>

                           <li class="col-xs-4">
                              <span>用户编号：</span>
                              <input type="text" class="form-control keyword2">
                           </li>
                           <li class="col-xs-4" style="padding-left: 10px">
                              <a href="javascript:;" class="btn btn-primary" @click="query()">查询</a>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="tablebox">
                     <table class="table">
                        <thead>
                           <tr>
                              <th><input type="checkbox" class="allsel"></th>
                              <th>优惠券编号</th>
                              <th>领取者编号</th>
                              <th>优惠券类型</th>
                              <th>优惠券状态</th>
                              <th>优惠券金额</th>
                              <th>是否已注销</th>
                              <th>操作</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr v-for="coupons in couponsList">
                              <td><input type="checkbox"></td>
                              <td class="coupons_id">{{coupons.coupons_id}}</td>
                              <td>{{coupons.user_id}}</td>
                              <td><span class="badge badge-info">{{coupons.coupons_type}}</span></td>
                              <td><span class="badge badge-success">{{coupons.coupons_state}}</span></td>
                              <td>{{coupons.coupons_fund}}</td>
                              <td>{{coupons.coupons_is_deleted}}</td>
                              <td>
                                 <a href="javascript:;" @click="updateCoupons($event)">修改</a>
                                 <a href="javascript:;"  @click="deleteCoupons($event)">删除</a>
                              </td>
                           </tr>
                           

                           <!-- <tr>
                              <td><input type="checkbox"></td>
                              <td>001</td>
                              <td>001</td>
                              <td><span class="badge badge-warning">无门槛券</span></td>
                              <td>5</td>
                              <td><span class="badge badge-danger">未发布</span></td>
                              <td>
                                 <a href="javascript:;" data-toggle="modal" data-target="#myModal">修改</a>
                                 <a href="javascript:;">删除</a>
                              </td>
                           </tr> -->

                          
                           
                           
                        </tbody>
                     </table>
                  </div>
                  <div class="">
                     <a href="javascript:;" class="btn btn-danger">删除</a>
                  </div>
                  <nav aria-label="Page navigation" class="page">
                     <ul class="pagination">
                        <li class="page-item">
                           <a class="page-link" href="javascript:;" aria-label="Previous">
                              <span aria-hidden="true">上一页</span>
                           </a>
                        </li>
                        <li class="page-item"><a class="page-link" href="javascript:;">1</a></li>
                        <li class="page-item"><a class="page-link" href="javascript:;">2</a></li>
                        <li class="page-item active"><a class="page-link" href="javascript:;">3</a></li>
                        <li class="page-item"><a class="page-link" href="javascript:;">4</a></li>
                        <li class="page-item"><a class="page-link" href="javascript:;">5</a></li>
                        <li class="page-item">
                           <a class="page-link" href="javascript:;" aria-label="Next">
                              <span aria-hidden="true">下一页</span>
                           </a>
                        </li>
                     </ul>
                  </nav>

               </div>
            </div>
         </div>

      </div>
   </div>


   <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title">添加优惠券</h5>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">×</span>
               </button>
            </div>
            <div class="modal-body">
               <form class="form form-horizontal">
                  <div class="form-body">
                     <div class="form-group row">
                        <label class="col-md-3 label-control" >优惠券类型</label>
                        <div class="col-md-9">
                           <fieldset class="form-group">
                              <select class="form-control m-b" v-model="newCouponsr.coupons_type">
                                 <option selected="" value="0">请选择状态</option>
                                 <option value="折扣券">折扣券</option>
                                 <option value="无门槛券">无门槛券</option>
                              </select>
                           </fieldset>
                        </div>
                     </div>

                     <div class="form-group row">
                        <label class="col-md-3 label-control">优惠券状态</label>
                        <div class="col-md-9">
                           <fieldset class="form-group">
                              <select class="form-control m-b" v-model="newCoupons.coupons_state">
                                 <option selected="" value="0">请选择状态</option>
                                 <option value="未使用">未使用</option>
                                 <option value="已使用">已使用</option>
                                 <option value="已过期">已过期</option>
                              </select>
                           </fieldset>
                        </div>
                     </div>

                     <div class="form-group row">
                        <label class="col-md-3 label-control" >优惠券金额</label>
                        <div class="col-md-9">
                           <input type="text" class="form-control" v-model="newCoupons.coupons_fund">
                        </div>
                     </div>

                     <div class="form-group row">
                        <label class="col-md-3 label-control">领取者编号</label>
                        <div class="col-md-9">
                           <input type="text" class="form-control" v-model="newCoupons.user_id">
                        </div>
                     </div>
                     <div class="form-group row">
                        <label class="col-md-3 label-control" >是否已注销</label>
                        <div class="col-md-9">
                           <fieldset class="form-group">
                              <select class="form-control m-b" v-model="newCoupons.coupons_is_deleted">
                                 <option value="0">0</option>
                                 <option value="1">1</option>
                              </select>
                           </fieldset>
                        </div>
                     </div>
                  </div>
               </form>

            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-def" data-dismiss="modal">关闭</button>
               <button type="button" class="btn btn-primary" @click="addNewCoupons()">执行操作</button>
            </div>
         </div>
      </div>
   </div>

   <script th:src="@{/js/jquery.min.js}"></script>
   <script th:src="@{/js/bootstrap.min.js}"></script>
   <script th:src="@{/js/smooth-scrollbar.js}"></script>
   <script th:src="@{/js/custom.js}"></script>
   <script th:src="@{/js/echarts.min.js}"></script>
   <script th:src="@{../js/axios-0.18.0.js}"></script>
   <script th:src="@{/js/vue.js}"></script>
   <script>
      new Vue({
         el: '#app',
         data: {
            state: 0,
            couponsList: [
               {
                  coupons_id: "001",
                  user_id: "002",
                  coupons_type: "折扣券",
                  coupons_state: "未使用",
                  coupons_fund: 300.00,
                  coupons_is_deleted: 0
               },
               {
                  coupons_id: "001",
                  user_id: "002",
                  coupons_type: "折扣券",
                  coupons_state: "未使用",
                  coupons_fund: 300.00,
                  coupons_is_deleted: 0
               },
               {
                  coupons_id: "001",
                  user_id: "002",
                  coupons_type: "折扣券",
                  coupons_state: "未使用",
                  coupons_fund: 300.00,
                  coupons_is_deleted: 0
               }
            ],
            // 新优惠券
            newCoupons: [
            {
                  coupons_id: "",
                  user_id: "",
                  coupons_type: "",
                  coupons_state: "",
                  coupons_fund: 0.00,
                  coupons_is_deleted: 0
               },
            ],
            // 复选框选中数据集合，点击复选框后一行数据以对象为单位全部保存进该数组
            multipleSelection: [],
            //保存选中的id号
            ids: [],
            //每页显示数
            pageSize: 5,
            //总条目数
            totalCount: 0,
            // 当前页码
            currentPage: 1,
         },
         mounted() {
            // 请求后端数据
            axios
               .get('/接口')
               .then(response => (//请求成功
                  console.log(response.data),
                  this.couponsList = response.data,
                  console.log(this.couponsList),
                  this.totalCount = response.data.count//设置总条数
               ))
               .catch(function (error) {
                  // console.log(error);//请求失败
               })
         },
         methods: {
            //删除优惠券
            deleteCoupons(e) {
               if (confirm("您是否确定删除")) {
                  var id = e.currentTarget.parentElement.parentElement.getElementsByClassName("coupons_id")[0].innerText;
                  this.state = 1;
                  axios.get('/接口?coupons_id=' + id + '&coupons_is_deleted=' + this.state)
                     .then(response => {
                        console.log(this.state);
                        console.log(response.data)//返回的数据
                     })
                     .catch(function (error) {
                        console.log(error);
                     })
               }
            },
            // 修改优惠券
            updateCoupons(e) {
               var id = e.currentTarget.parentElement.parentElement.getElementsByClassName("coupons_id")[0].innerText;
               e.currentTarget.href = 'Modify_coupons?coupons_id=' + id;
               console.log(e.currentTarget.href);
            },
            // 复选框选中后执行的方法
            handleSelectionChange(val) {
               this.multipleSelection = val;
            },
            // 批量删除员工
            deleteByids() {
               this.multipleSelection.forEach((item) => {
                  this.ids.push(item.id)
               })
               console.log(this.ids)
               if (this.ids.length == 0) {
                  this.$message({
                     type: 'success',
                     message: '请先选择需要删除的信息'
                  })
               } else {
                  this.$confirm('你确定吗？', '提示', {
                     confirmButtonText: "确认删除？",
                     concelButtonText: "取消",
                     type: 'warning'
                  }).then(function (resp) {
                     axios({
                        method: "get",
                        url: "/接口",
                        data: ids
                     }).then(function (resp) {
                        if (resp.data > 0) {
                           mounted();
                        }
                     })
                  })
               }
            },

            // 添加新优惠券
            addNewCoupons() {
               axios
                  .post('/接口', this.newCoupons).then(response => (
                     console.log(response.data),
                     this.newCoupons = {}
                  ))
                  .catch(function (error) { // 请求失败处理
                     console.log(error);
                  });
            },
            // 按编号查询
            query1() {
               var keyword = $(".keyword").val();
               if (keyword == null|| keyword == "") {
                  Field = "all"
               }
               axios({
                  method: 'get',
                  url: '/接口?keyword=' + keyword 
               }).then(res => {
                  console.log("查询成功");
                  console.log(res.data);
                  if (res.data == null) {
                     this.commodityList = [];
                  } else {
                     this.commodityList = res.data;
                  }
               }, err => {
                  console.log(err);
               })
            },
            // 按字段查询
            query() {
               var keyword1 = $(".keyword1").val();
               var keyword2 = $(".keyword2").val();
               if (keyword1 == null && keyword2 == null || keyword1 == "" && keyword2 == "") {
                  Field = "all"
               }
               axios({
                  method: 'get',
                  url: '/接口?keyword1=' + keyword1 + '&keyword2=' + keyword2,
               }).then(res => {
                  console.log("查询成功");
                  console.log(res.data);
                  if (res.data == null) {
                     this.couponsList = [];
                  } else {
                     this.couponsList = res.data;
                  }
               }, err => {
                  console.log(err);
               })
            },
            //分页
            handleSizeChange(val) {
               // console.log(`每页 ${val} 条`);
               //设置每一页的分页查询
               this.pageSize = val
               mounted();
            },
            handleCurrentChange(val) {
               //console.log(`当前页: ${val}`);
               //重新设置当前页码
               this.currentPage = val
               mounted();
            }
         }
      })
   </script>

</body>

</html>